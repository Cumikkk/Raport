<!-- ================= ALERT + PAGINATION CONTROLLER ================= -->

<style>
/* ================= ALERT ANIMATION ================= */
.dk-alert {
  opacity: 0;
  transform: translateY(-10px);
  max-height: 240px;
  overflow: hidden;
  transition:
    opacity .35s ease,
    transform .35s ease,
    max-height .35s ease,
    margin .35s ease,
    padding .35s ease;
}

.dk-alert.dk-show {
  opacity: 1;
  transform: translateY(0);
}

.dk-alert.dk-hide {
  opacity: 0;
  transform: translateY(-6px);
  max-height: 0;
  margin: 0 !important;
  padding-top: 0 !important;
  padding-bottom: 0 !important;
}

/* ================= PAGINATION SPACE ================= */
/* supaya dropdown data/hal selalu kebuka ke BAWAH */
.content {
  padding-bottom: 260px;
}
</style>

<script>
// ================= GLOBAL CONFIG =================
const ALERT_DURATION = 4000;

// ================= ALERT CORE =================
function alertIn(el) {
  requestAnimationFrame(() => el.classList.add('dk-show'));
}

function alertOut(el) {
  el.classList.add('dk-hide');
  setTimeout(() => {
    if (el && el.parentNode) el.parentNode.removeChild(el);
  }, 450);
}

function wireAlert(el) {
  if (!el) return;
  alertIn(el);

  const timer = setTimeout(() => alertOut(el), ALERT_DURATION);

  const closeBtn = el.querySelector('.close-btn');
  if (closeBtn) {
    closeBtn.addEventListener('click', (e) => {
      e.preventDefault();
      clearTimeout(timer);
      alertOut(el);
    });
  }
}

// ================= TOP ALERT (AUTO SCROLL) =================
function showTopAlert(type, message) {
  const area = document.getElementById('alertAreaTop');
  if (!area) return;

  const alert = document.createElement('div');
  alert.className = `dk-alert dk-alert-${type}`;
  alert.innerHTML = `
    <span class="close-btn">&times;</span>
    ${message}
  `;

  area.prepend(alert);
  wireAlert(alert);

  // auto scroll ke atas
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}

// ================= MODAL ALERT (NO ERROR) =================
function showModalAlert(containerId, type, message) {
  const box = document.getElementById(containerId);
  if (!box) return;

  box.innerHTML = '';

  const alert = document.createElement('div');
  alert.className = `dk-alert dk-alert-${type}`;
  alert.innerHTML = `
    <span class="close-btn">&times;</span>
    ${message}
  `;

  box.appendChild(alert);
  wireAlert(alert);
}

// ================= PAGINATION + PER PAGE =================
function buildPagination(totalRows, page, perPage) {
  const paginationWrap = document.getElementById('paginationWrap');
  const pageInfo = document.getElementById('pageInfo');
  const perSelect = document.getElementById('perPage');

  const isAll = (parseInt(perPage, 10) === 0);
  const totalPages = isAll ? 1 : Math.max(1, Math.ceil(totalRows / perPage));
  page = isAll ? 1 : Math.min(page, totalPages);

  let shown = 0;
  if (totalRows > 0) {
    shown = isAll
      ? totalRows
      : Math.min(perPage, totalRows - (page - 1) * perPage);
  }

  pageInfo.innerHTML = `
    Menampilkan <strong>${shown}</strong> dari <strong>${totalRows}</strong> data •
    Halaman <strong>${page}</strong> / <strong>${totalPages}</strong>
  `;

  const makeLi = (disabled, target, label, active = false) => `
    <li class="page-item ${disabled ? 'disabled' : ''} ${active ? 'active' : ''}">
      <a href="#" class="page-link" data-page="${target}">${label}</a>
    </li>
  `;

  let html = '';
  html += makeLi(page === 1, 1, '«');
  html += makeLi(page === 1, page - 1, '‹');

  if (isAll) {
    html += makeLi(false, 1, '1', true);
  } else {
    for (let i = Math.max(1, page - 2); i <= Math.min(totalPages, page + 2); i++) {
      html += makeLi(false, i, i, i === page);
    }
  }

  html += makeLi(page === totalPages, page + 1, '›');
  html += makeLi(page === totalPages, totalPages, '»');

  paginationWrap.innerHTML = html;

  paginationWrap.querySelectorAll('a[data-page]').forEach(a => {
    a.addEventListener('click', (e) => {
      e.preventDefault();
      if (isAll) return;
      const target = parseInt(a.dataset.page, 10);
      if (!isNaN(target)) {
        doSearch(currentQuery, target, currentPerPage, true);
      }
    });
  });

  perSelect.value = String(perPage);
}

// ================= INIT EXISTING ALERT =================
document.querySelectorAll('.dk-alert').forEach(wireAlert);
</script>

<!-- ================= END ALERT + PAGINATION CONTROLLER ================= -->
